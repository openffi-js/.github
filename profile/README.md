# openffi

openffi is a project that takes widely used libraries written in lower level languages like C, Rust, and Zig, and packages them into shared library files that are then distributed through npm packages. This allows for programs in the JS ecosystem to take full advantage of the native-level performance offered by these libraries.

Usage is as simple as installing the npm package you want; the default export from the package will be a path to the correct shared library file for your OS and CPU architecture. A runtime like Bun can `dlopen` shared library files allowing you to call the native functions directly from JS code. Here is libgit2 as an example:

Run `npm install @openffi/libgit2` and then run the following code:

```js
import { dlopen, FFIType } from "bun:ffi";
import libgit2 from "@openffi/libgit2";

// int git_libgit2_version(int *major, int *minor, int *rev);
const {
  symbols: { git_libgit2_version },
} = dlopen(libgit2, {
  git_libgit2_version: {
    args: ["ptr", "ptr", "ptr"],
    returns: FFIType.i32,
  },
});

const major = new Int32Array(1);
const minor = new Int32Array(1);
const rev = new Int32Array(1);
const ret = git_libgit2_version(major, minor, rev);
console.log(ret, major[0], minor[0], rev[0]);
```

All libraries are built from source on GitHub actions and then published to npm in two variants - a standard package and a `-all` variant. The standard package can be used and installed as shown above. The `-all` variant includes the shared library files for all available OS and CPU architectures, as well as some JS glue to support `bun build --compile` so the shared library file gets bundled into the single-file executable generated by Bun.

openffi is currently maintained by @tarunbod.
